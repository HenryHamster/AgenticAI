# Docker Compose for Multi-Agent Deployment (Coolify compatible)
# Each agent runs in its own container with AgentBeats controller
# Architecture follows AgentBeats integration pattern with earthshaker

services:
  # Green Agent - Game Judge/Orchestrator
  # Uses agentbeats run_ctrl for lifecycle management
  green_agent:
    build:
      context: .
      dockerfile: coolify/green_agent/Dockerfile
    expose:
      - "8010"
    environment:
      # Public URL for agent card discovery
      - PUBLIC_URL=${GREEN_AGENT_URL}
      # Controller configuration
      - CONTROLLER_PORT=8010
      - HOST=0.0.0.0
      # API Keys
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - CLAUDE_API_KEY=${CLAUDE_API_KEY:-}
      - CLOUDRUN_HOST=${GREEN_AGENT_URL_NO_PROTOCOL}
      - HTTPS_ENABLED=true
    volumes:
      - green_agent_logs:/var/log/agents
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8010/status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s

  # White Agent - Player Agent
  # Uses agentbeats run_ctrl for lifecycle management
  white_agent:
    build:
      context: .
      dockerfile: coolify/white_agent/Dockerfile
    expose:
      - "8010"
    environment:
      # Public URL for agent card discovery
      - PUBLIC_URL=${WHITE_AGENT_URL}
      # Controller configuration
      - CONTROLLER_PORT=8010
      - HOST=0.0.0.0
      # API Keys
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - CLOUDRUN_HOST=${WHITE_AGENT_URL_NO_PROTOCOL}
      - HTTPS_ENABLED=true
    volumes:
      - white_agent_logs:/var/log/agents
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8010/status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s

volumes:
  green_agent_logs:
  white_agent_logs:
